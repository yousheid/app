<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arisan Management App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-roboto">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Arisan Management App</h1>
        <div class="bg-white p-4 rounded shadow-md mb-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="blok" class="block text-sm font-medium text-gray-700">Blok</label>
                    <input type="text" id="blok" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                <div>
                    <label for="nama" class="block text-sm font-medium text-gray-700">Nama</label>
                    <input type="text" id="nama" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                <div>
                    <label for="ar" class="block text-sm font-medium text-gray-700">Arisan</label>
                    <div class="flex items-center mt-1">
                        <input type="checkbox" id="ar" class="mr-2">
                        <input type="number" id="ar_input" class="block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0">
                    </div>
                </div>
                <div>
                    <label for="kon" class="block text-sm font-medium text-gray-700">Konsumsi</label>
                    <div class="flex items-center mt-1">
                        <input type="checkbox" id="kon" class="mr-2">
                        <input type="number" id="kon_input" class="block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0">
                    </div>
                </div>
                <div>
                    <label for="sam" class="block text-sm font-medium text-gray-700">Sampah</label>
                    <div class="flex items-center mt-1">
                        <input type="checkbox" id="sam" class="mr-2">
                        <input type="number" id="sam_input" class="block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0">
                    </div>
                </div>
                <div>
                    <label for="kas" class="block text-sm font-medium text-gray-700">Kas</label>
                    <div class="flex items-center mt-1">
                        <input type="checkbox" id="kas" class="mr-2">
                        <input type="number" id="kas_input" class="block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0">
                    </div>
                </div>
                <div>
                    <label for="bayar" class="block text-sm font-medium text-gray-700">Bayar</label>
                    <input type="number" id="bayar" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0">
                </div>
                <div>
                    <label for="total" class="block text-sm font-medium text-gray-700">Total</label>
                    <input type="number" id="total" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" value="0" readonly>
                </div>
            </div>
            <div class="mt-4 flex space-x-2">
                <button id="save" class="bg-blue-500 text-white px-4 py-2 rounded shadow">Simpan</button>
                <button id="export" class="bg-green-500 text-white px-4 py-2 rounded shadow">Export ke *.xlsx</button>
                <button id="print" class="bg-yellow-500 text-white px-4 py-2 rounded shadow">Print</button>
                <button id="delete_user" class="bg-red-500 text-white px-4 py-2 rounded shadow">Delete User</button>
                <button id="delete_all" class="bg-red-700 text-white px-4 py-2 rounded shadow">Delete All</button>
            </div>
        </div>
        <div class="bg-white p-4 rounded shadow-md mb-4">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Blok</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Arisan</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Konsumsi</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sampah</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kas</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bayar</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                    </tr>
                </thead>
                <tbody id="table_body" class="bg-white divide-y divide-gray-200">
                    <!-- Rows will be added here dynamically -->
                </tbody>
            </table>
        </div>
        <div class="bg-white p-4 rounded shadow-md">
            <h2 class="text-xl font-bold mb-4">Rincian Pemasukan</h2>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis Iuran</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pemasukan</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pengeluaran</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Saldo</th>
                    </tr>
                </thead>
                <tbody id="rincian_body" class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap">1</td>
                        <td class="px-2 py-2 whitespace-nowrap">Arisan</td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap">2</td>
                        <td class="px-2 py-2 whitespace-nowrap">Konsumsi</td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap">3</td>
                        <td class="px-2 py-2 whitespace-nowrap">Sampah</td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap">4</td>
                        <td class="px-2 py-2 whitespace-nowrap">Kas</td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap">5</td>
                        <td class="px-2 py-2 whitespace-nowrap">Selokan</td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td class="px-2 py-2 whitespace-nowrap font-bold">TOTAL</td>
                        <td class="px-2 py-2 whitespace-nowrap"></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" id="total_pemasukan" class="block w-full rounded-md p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" id="total_pengeluaran" class="block w-full rounded-md p-2" value="0" readonly></td>
                        <td class="px-2 py-2 whitespace-nowrap"><input type="number" id="total_saldo" class="block w-full rounded-md p-2" value="0" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="mt-4 flex justify-end">
                <button id="add_row" class="bg-blue-500 text-white px-4 py-2 rounded shadow"><i class="fas fa-plus"></i></button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const arCheckbox = document.getElementById('ar');
            const arInput = document.getElementById('ar_input');
            const konCheckbox = document.getElementById('kon');
            const konInput = document.getElementById('kon_input');
            const samCheckbox = document.getElementById('sam');
            const samInput = document.getElementById('sam_input');
            const kasCheckbox = document.getElementById('kas');
            const kasInput = document.getElementById('kas_input');
            const bayarInput = document.getElementById('bayar');
            const totalInput = document.getElementById('total');
            const saveButton = document.getElementById('save');
            const exportButton = document.getElementById('export');
            const printButton = document.getElementById('print');
            const deleteUserButton = document.getElementById('delete_user');
            const deleteAllButton = document.getElementById('delete_all');
            const tableBody = document.getElementById('table_body');
            const rincianBody = document.getElementById('rincian_body');
            const addRowButton = document.getElementById('add_row');

            const updateTotal = () => {
                const arValue = arCheckbox.checked ? 5000 + parseInt(arInput.value) : parseInt(arInput.value);
                const konValue = konCheckbox.checked ? 5000 + parseInt(konInput.value) : parseInt(konInput.value);
                const samValue = samCheckbox.checked ? 18000 + parseInt(samInput.value) : parseInt(samInput.value);
                const kasValue = kasCheckbox.checked ? 2000 + parseInt(kasInput.value) : parseInt(kasInput.value);
                const bayarValue = parseInt(bayarInput.value);
                const totalValue = arValue + konValue + samValue + kasValue - bayarValue;
                totalInput.value = totalValue;
            };

            const updateRincian = () => {
                let totalPemasukan = 0;
                let totalPengeluaran = 0;
                let totalSaldo = 0;

                rincianBody.querySelectorAll('tr').forEach((row, index) => {
                    if (index < rincianBody.querySelectorAll('tr').length - 1) {
                        const pemasukanInput = row.querySelector('.pemasukan_input');
                        const pengeluaranInput = row.querySelector('.pengeluaran_input');
                        const saldoInput = row.querySelector('.saldo_input');

                        const pemasukan = parseInt(pemasukanInput.value);
                        const pengeluaran = parseInt(pengeluaranInput.value);
                        const saldo = pemasukan - pengeluaran;

                        saldoInput.value = saldo;

                        totalPemasukan += pemasukan;
                        totalPengeluaran += pengeluaran;
                        totalSaldo += saldo;
                    }
                });

                document.getElementById('total_pemasukan').value = totalPemasukan;
                document.getElementById('total_pengeluaran').value = totalPengeluaran;
                document.getElementById('total_saldo').value = totalSaldo;
            };

            arCheckbox.addEventListener('change', updateTotal);
            konCheckbox.addEventListener('change', updateTotal);
            samCheckbox.addEventListener('change', updateTotal);
            kasCheckbox.addEventListener('change', updateTotal);
            arInput.addEventListener('input', updateTotal);
            konInput.addEventListener('input', updateTotal);
            samInput.addEventListener('input', updateTotal);
            kasInput.addEventListener('input', updateTotal);
            bayarInput.addEventListener('input', updateTotal);

            const saveDataToLocalStorage = () => {
                const rows = [];
                tableBody.querySelectorAll('tr').forEach(row => {
                    const rowData = {
                        blok: row.children[0].textContent,
                        nama: row.children[1].textContent,
                        arisan: row.children[2].textContent,
                        konsumsi: row.children[3].textContent,
                        sampah: row.children[4].textContent,
                        kas: row.children[5].textContent,
                        bayar: row.children[6].textContent,
                        total: row.children[7].textContent
                    };
                    rows.push(rowData);
                });
                localStorage.setItem('arisanData', JSON.stringify(rows));
            };

            const loadDataFromLocalStorage = () => {
                const rows = JSON.parse(localStorage.getItem('arisanData')) || [];
                rows.forEach(rowData => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.blok}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.nama}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.arisan}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.konsumsi}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.sampah}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.kas}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.bayar}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${rowData.total}</td>
                    `;
                    tableBody.appendChild(row);
                });
            };

            saveButton.addEventListener('click', () => {
                const blok = document.getElementById('blok').value;
                const nama = document.getElementById('nama').value;

                if (!blok || !nama) {
                    alert('Blok dan Nama wajib diisi!');
                    return;
                }

                const arValue = arCheckbox.checked ? 5000 + parseInt(arInput.value) : parseInt(arInput.value);
                const konValue = konCheckbox.checked ? 5000 + parseInt(konInput.value) : parseInt(konInput.value);
                const samValue = samCheckbox.checked ? 18000 + parseInt(samInput.value) : parseInt(samInput.value);
                const kasValue = kasCheckbox.checked ? 2000 + parseInt(kasInput.value) : parseInt(kasInput.value);
                const bayarValue = parseInt(bayarInput.value);
                const totalValue = arValue + konValue +kasValue + samValue - bayarValue;

                let isUpdate = false;
                tableBody.querySelectorAll('tr').forEach(row => {
                    if (row.children[0].textContent === blok && row.children[1].textContent === nama) {
                        row.children[2].textContent = arValue;
                        row.children[3].textContent = konValue;
                        row.children[4].textContent = samValue;
                        row.children[5].textContent = kasValue;
                        row.children[6].textContent = bayarValue;
                        row.children[7].textContent = totalValue;
                        isUpdate = true;
                    }
                });

                if (!isUpdate) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-2 py-2 whitespace-nowrap">${blok}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${nama}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${arValue}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${konValue}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${samValue}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${kasValue}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${bayarValue}</td>
                        <td class="px-2 py-2 whitespace-nowrap">${totalValue}</td>
                    `;
                    tableBody.appendChild(row);
                }

                saveDataToLocalStorage();

                // Update rincian pemasukan
                rincianBody.querySelectorAll('tr').forEach((row, index) => {
                    if (index < rincianBody.querySelectorAll('tr').length - 1) {
                        const jenisIuran = row.children[1].textContent.toLowerCase();
                        const pemasukanInput = row.querySelector('.pemasukan_input');
                        if (jenisIuran === 'arisan') {
                            pemasukanInput.value = parseInt(pemasukanInput.value) + arValue;
                        } else if (jenisIuran === 'konsumsi') {
                            pemasukanInput.value = parseInt(pemasukanInput.value) + konValue;
                        } else if (jenisIuran === 'sampah') {
                            pemasukanInput.value = parseInt(pemasukanInput.value) + samValue;
                        } else if (jenisIuran === 'kas') {
                            pemasukanInput.value = parseInt(pemasukanInput.value) + kasValue;
                        }
                    }
                });

                updateRincian();
            });

            exportButton.addEventListener('click', () => {
                // Export to XLSX functionality
            });

            printButton.addEventListener('click', () => {
                window.print();
            });

            deleteUserButton.addEventListener('click', () => {
                const nama = document.getElementById('nama').value;
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (row.children[1].textContent === nama) {
                        tableBody.removeChild(row);
                    }
                });

                saveDataToLocalStorage();

                // Update rincian pemasukan
                rincianBody.querySelectorAll('tr').forEach((row, index) => {
                    if (index < rincianBody.querySelectorAll('tr').length - 1) {
                        const jenisIuran = row.children[1].textContent.toLowerCase();
                        const pemasukanInput = row.querySelector('.pemasukan_input');
                        if (jenisIuran === 'arisan') {
                            pemasukanInput.value = 0;
                        } else if (jenisIuran === 'konsumsi') {
                            pemasukanInput.value = 0;
                        } else if (jenisIuran === 'sampah') {
                            pemasukanInput.value = 0;
                        } else if (jenisIuran === 'kas') {
                            pemasukanInput.value = 0;
                        }
                    }
                });

                tableBody.querySelectorAll('tr').forEach(row => {
                    const arValue = parseInt(row.children[2].textContent);
                    const konValue = parseInt(row.children[3].textContent);
                    const samValue = parseInt(row.children[4].textContent);
                    const kasValue = parseInt(row.children[5].textContent);

                    rincianBody.querySelectorAll('tr').forEach((row, index) => {
                        if (index < rincianBody.querySelectorAll('tr').length - 1) {
                            const jenisIuran = row.children[1].textContent.toLowerCase();
                            const pemasukanInput = row.querySelector('.pemasukan_input');
                            if (jenisIuran === 'arisan') {
                                pemasukanInput.value = parseInt(pemasukanInput.value) + arValue;
                            } else if (jenisIuran === 'konsumsi') {
                                pemasukanInput.value = parseInt(pemasukanInput.value) + konValue;
                            } else if (jenisIuran === 'sampah') {
                                pemasukanInput.value = parseInt(pemasukanInput.value) + samValue;
                            } else if (jenisIuran === 'kas') {
                                pemasukanInput.value = parseInt(pemasukanInput.value) + kasValue;
                            }
                        }
                    });
                });

                updateRincian();
            });

            deleteAllButton.addEventListener('click', () => {
                tableBody.innerHTML = '';
                localStorage.removeItem('arisanData');

                // Reset rincian pemasukan
                rincianBody.querySelectorAll('tr').forEach((row, index) => {
                    if (index < rincianBody.querySelectorAll('tr').length - 1) {
                        const pemasukanInput = row.querySelector('.pemasukan_input');
                        const pengeluaranInput = row.querySelector('.pengeluaran_input');
                        const saldoInput = row.querySelector('.saldo_input');

                        pemasukanInput.value = 0;
                        pengeluaranInput.value = 0;
                        saldoInput.value = 0;
                    }
                });

                updateRincian();
            });

            rincianBody.addEventListener('input', (event) => {
                if (event.target.classList.contains('pengeluaran_input')) {
                    updateRincian();
                }
            });

            addRowButton.addEventListener('click', () => {
                const rowCount = rincianBody.querySelectorAll('tr').length;
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td class="px-2 py-2 whitespace-nowrap">${rowCount}</td>
                    <td class="px-2 py-2 whitespace-nowrap"><input type="text" class="block w-full p-2" value=""></td>
                    <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pemasukan_input block w-full p-2" value="0"></td>
                    <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="pengeluaran_input block w-full p-2" value="0"></td>
                    <td class="px-2 py-2 whitespace-nowrap"><input type="number" class="saldo_input block w-full p-2" value="0" readonly></td>
                `;
                rincianBody.insertBefore(newRow, rincianBody.querySelector('tr:last-child'));

                updateRincian();
            });

            tableBody.addEventListener('mouseover', (event) => {
                const row = event.target.closest('tr');
                if (row) {
                    document.getElementById('blok').value = row.children[0].textContent;
                    document.getElementById('nama').value = row.children[1].textContent;
                    arInput.value = row.children[2].textContent;
                    konInput.value = row.children[3].textContent;
                    samInput.value = row.children[4].textContent;
                    kasInput.value = row.children[5].textContent;
                    bayarInput.value =row.children[6].textContent;
                    totalInput.value =row.children[7].textContent;
                }
            });

            loadDataFromLocalStorage();
        });
    </script>
  
</body>
</html>
